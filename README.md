# iac-testenv-construction
VirtualBox,Vagrant,Terraform,Ansible,AWXã®ç’°å¢ƒæ§‹ç¯‰ã€å‹•ä½œç¢ºèªãªã©æ¤œè¨¼ç”¨

IaCç·´ç¿’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®çš„ã¯ã€Ansibleã€Dockerã€Terraformã€Chef ãªã©ã«ã‚ˆã‚‹**è¤‡æ•°ç’°å¢ƒã®è‡ªå‹•æ§‹ç¯‰ã¨é€£æº**

ä»¥ä¸‹ã‚’åŠ å‘³ã—ãŸ**ç™ºå±•çš„ã§æ•´ç†ã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ**ã‚’è¨˜è¼‰

- ãƒãƒ«ãƒVMç®¡ç†ï¼ˆVagrant + Terraformï¼‰
- ãƒãƒ«ãƒæ§‹æˆç®¡ç†ï¼ˆAnsible, Chefï¼‰
- ã‚³ãƒ³ãƒ†ãƒŠç’°å¢ƒï¼ˆDocker, Kubernetes, Helmï¼‰
- ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆï¼ˆPackerï¼‰
- CI/CDãƒ„ãƒ¼ãƒ«é€£æºï¼ˆGitHub Actions, Drone CIï¼‰

---

## ğŸ“ æœ€çµ‚ææ¡ˆï¼šIaCç·´ç¿’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®çµ±åˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
iac_lab/
â”œâ”€â”€ environments/                # ä»®æƒ³ç’°å¢ƒï¼ˆVMï¼‰å˜ä½ã§ã¾ã¨ã‚ã‚‹
â”‚   â”œâ”€â”€ base_vm/                # æ¥ç¶šç¢ºèªãªã©æœ€å°æ§‹æˆç”¨
â”‚   â”œâ”€â”€ awx_vm/                 # AWX/K8sç”¨ã®VMç’°å¢ƒ
â”‚   â””â”€â”€ docker_host/            # Dockerä¸­å¿ƒã®ç’°å¢ƒæ§‹ç¯‰ç”¨
â”‚
â”œâ”€â”€ terraform/                  # Terraformå®šç¾©ã€‚ç’°å¢ƒã”ã¨ã«åˆ†å‰²
â”‚   â”œâ”€â”€ base_vm/
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ variables.tf
â”‚   â”‚   â””â”€â”€ terraform.tfstate
â”‚   â”œâ”€â”€ awx_vm/
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â””â”€â”€ variables.tf
â”‚   â””â”€â”€ shared/                 # å…±é€šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãªã©ï¼ˆä»»æ„ï¼‰
â”‚       â””â”€â”€ network.tf
â”‚
â”œâ”€â”€ vagrant/                    # VMã®èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆVagrantfileï¼‰
â”‚   â”œâ”€â”€ base_vm/Vagrantfile
â”‚   â””â”€â”€ awx_vm/Vagrantfile
â”‚
â”œâ”€â”€ ansible/                    # Ansibleã«ã‚ˆã‚‹æ§‹æˆç®¡ç†
â”‚   â”œâ”€â”€ inventories/
â”‚   â”‚   â”œâ”€â”€ base_vm.ini
â”‚   â”‚   â””â”€â”€ awx_vm.ini
â”‚   â”œâ”€â”€ playbooks/
â”‚   â”‚   â”œâ”€â”€ setup_base.yml
â”‚   â”‚   â””â”€â”€ deploy_awx.yml
â”‚   â””â”€â”€ roles/
â”‚       â”œâ”€â”€ apache/
â”‚       â””â”€â”€ docker/
â”‚
â”œâ”€â”€ chef/                       # Chef Soloã¾ãŸã¯Zeroã§æ§‹æˆç®¡ç†
â”‚   â”œâ”€â”€ cookbooks/
â”‚   â”‚   â””â”€â”€ apache/
â”‚   â””â”€â”€ environments/
â”‚       â””â”€â”€ base_vm.json
â”‚
â”œâ”€â”€ docker/                     # Dockeré–¢é€£ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒ
â”‚   â”œâ”€â”€ nginx_server/
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â””â”€â”€ docker-compose.yml
â”‚   â””â”€â”€ awx_test/
â”‚       â””â”€â”€ compose.yml
â”‚
â”œâ”€â”€ kubernetes/                 # K8sé–¢é€£ï¼ˆHelmã€manifestï¼‰
â”‚   â”œâ”€â”€ manifests/
â”‚   â”‚   â””â”€â”€ awx.yaml
â”‚   â”œâ”€â”€ helm/
â”‚   â”‚   â””â”€â”€ awx-chart/
â”‚   â””â”€â”€ minikube_setup.sh
â”‚
â”œâ”€â”€ packer/                     # VMã‚„AMIã®è‡ªå‹•ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆ
â”‚   â”œâ”€â”€ ubuntu2204.json
â”‚   â””â”€â”€ scripts/
â”‚       â””â”€â”€ install_docker.sh
â”‚
â”œâ”€â”€ ci_cd/                      # CI/CDæ§‹æˆï¼ˆGitHub Actions, Droneãªã©ï¼‰
â”‚   â”œâ”€â”€ github/
â”‚   â”‚   â””â”€â”€ workflows/
â”‚   â”‚       â””â”€â”€ terraform_plan.yml
â”‚   â””â”€â”€ drone/
â”‚       â””â”€â”€ .drone.yml
â”‚
â”œâ”€â”€ scripts/                    # å…±é€šã§ä½¿ã†ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæ‰‹å‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãªã©ï¼‰
â”‚   â”œâ”€â”€ install_common_tools.sh
â”‚   â””â”€â”€ setup_k8s.sh
â”‚
â””â”€â”€ README.md                   # æ¦‚è¦ãƒ»ä½¿ã„æ–¹ãƒ»æ§‹ç¯‰æ‰‹é †ãªã©ã‚’è¨˜è¼‰

```

---

## ğŸ“Œ å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è£œè¶³ã¨æ³¨æ„ç‚¹

| ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | èª¬æ˜ãƒ»æ³¨æ„ç‚¹ |
|--------------|-------------|
| `environments/` | è¤‡æ•°VMã‚’ç®¡ç†ã€‚ç’°å¢ƒå˜ä½ã§ã¾ã¨ã‚ã‚‹ã“ã¨ã§Terraformãƒ»Vagrantãƒ»Ansibleã‹ã‚‰ä¸€è²«ç®¡ç†ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚ |
| `vagrant/` | VMä½œæˆå°‚ç”¨ã€‚å†åˆ©ç”¨æ€§ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã«ä¾¿åˆ©ã€‚Vagrantfileã¯ç’°å¢ƒã”ã¨ã«åˆ†ã‘ã‚‹ã¨ã‚ˆã„ã€‚ |
| `terraform/` | null_resourceã‚„remote-execã€å°†æ¥çš„ã«ã¯cloud providerã¸ã®ç§»è¡Œã‚‚è€ƒæ…®ã€‚æ§‹æˆå¤‰æ›´ã«å¼·ã„ã€‚ |
| `ansible/` | playbook/roles/inventoriesæ§‹æˆã§æ¨™æº–çš„ã€‚VMã‚„Dockerä¸¡æ–¹ã«å±•é–‹ã§ãã‚‹è¨­è¨ˆã‚’ç›®æŒ‡ã™ã€‚ |
| `chef/` | Chef soloå‘ã‘ã€‚ä»Šå¾Œknifeã‚„Chef Serverã‚‚å­¦ã¶ãªã‚‰æ§‹æˆå¤‰æ›´ã®ä½™åœ°ã‚ã‚Šã€‚ |
| `docker/` | å„ç¨®æ§‹ç¯‰ç’°å¢ƒã‚’Dockerã§è©¦ã™å ´ã€‚ã‚µãƒ¼ãƒ“ã‚¹å˜ä½ã‚„ç’°å¢ƒå˜ä½ã§åˆ†ã‘ã‚‹ã¨æ•´ç†ã—ã‚„ã™ã„ã€‚ |
| `kubernetes/` | minikube/helm/kustomizeã‚’ç®¡ç†ã€‚manifestã‚’ç›´æ¥æ›¸ããƒ‘ã‚¿ãƒ¼ãƒ³ã¨Helmä½µç”¨ã‚‚æƒ³å®šã€‚ |
| `packer/` | VMã‚„AWS AMIã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’è‡ªå‹•ç”Ÿæˆã€‚CIã¨é€£æºã™ã‚‹ã“ã¨ã§å®Ÿæˆ¦çš„ã«ãªã‚‹ã€‚ |
| `ci_cd/` | GitHub Actionsã‚„Droneãªã©ã€‚Terraform Planã®è‡ªå‹•åŒ–ã‚„Ansible Playbookã®å®Ÿè¡Œé€£æºã‚‚å¯èƒ½ã€‚ |
| `scripts/` | å…±é€šã§ä½¿ã„å›ã™å‡¦ç†ï¼ˆapt installãªã©ï¼‰ã‚’ã¾ã¨ã‚ã€DRYåŸå‰‡ã‚’ç¶­æŒã€‚ |

---

## âœ… ã“ã®æ§‹æˆã®ãƒ¡ãƒªãƒƒãƒˆ

- **ç›®çš„åˆ¥ + ãƒ„ãƒ¼ãƒ«åˆ¥ã®æ˜ç¢ºãªåˆ†é›¢**ã§ä¿å®ˆãƒ»è¿½åŠ ãŒã—ã‚„ã™ã„
- **ãƒ„ãƒ¼ãƒ«æ¨ªæ–­ã§åŒã˜VMã‚„ç’°å¢ƒã«æ§‹æˆã‚’å½“ã¦ã‚‰ã‚Œã‚‹**
- **æ‹¡å¼µæ€§ãŒé«˜ãã€CI/CDãƒ»Cloudé€£æºã«ã‚‚ã¤ãªã’ã‚„ã™ã„**

---

å¿…è¦ãªã‚‰ã“ã®æ§‹æˆã§`README.md`ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚„ã€`base_vm`ã®Vagrantfileé››å½¢ã‚‚ã”æä¾›ã§ãã¾ã™ã€‚  